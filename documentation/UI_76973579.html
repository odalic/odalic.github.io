<!DOCTYPE html>
<html>
    <head>
        <title>ADEQUATE : UI</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">ADEQUATE</a></span>
                            </li>
                                                    <li>
                                <span><a href="Odalic_71438906.html">Odalic</a></span>
                            </li>
                                                    <li>
                                <span><a href="ODALIC-Documentation_76973575.html">ODALIC Documentation</a></span>
                            </li>
                                                    <li>
                                <span><a href="Developer-Documentation_76973577.html">Developer Documentation</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            ADEQUATE : UI
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> István Satmári</span>, last modified on Mai 15, 2017
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <h1 id="UI-Introduction">Introduction</h1><p>We decided to go with the approach of developing a single page application (SPA), which would communicate with the server via REST application interface. This way the server is lighter and does not have to deal with issues on the client's side. It allows for the server to be (almost) completely isolated, more secure, and puts weight of computing page look solely on the client's computer, which in turn increases the overall throughput of the server. Modern internet browsers make this approach possible on almost every popular platform.</p><p>We decided to stick with the basic personal computers as our platform of choice with installed browser(s) that support(s) HTML5, such as Microsoft<sup>®</sup> Edge 14 <em>(or newer)</em>, Mozilla Firefox 50 <em>(or newer) </em>and<em> </em>Google<sup>®</sup> Chrome 49 <em>(or newer).</em> We used JavaScript language and Angular (<a href="https://angularjs.org/" class="external-link" rel="nofollow">https://angularjs.org/</a>) framework for the overall UI development, which would also determine the application architecture. <span class="inline-comment-marker" data-ref="3f119ae4-c482-4e8f-ae6e-4ce07b0315fa">Angular was chosen based on its popularity, good documentation and robustness, providing the desired functionality for almost everything we needed.</span></p><h1 id="UI-Architecture">Architecture</h1><p>Angular separates the entire application into several 'views'. It basically maps a route to a template which is then used for display. We usually call these 'views' as 'screens'. Each screen consists of a template, which is a portion of HTML code, and controller, being a piece of JavaScript code that 'controls' the template, providing functionalities for user interaction. During development, our goal was to put most of the code that determines visuals and contents of each screen into templates, while leaving controllers 'clean', providing only the necessary functions requested by templates. This also explains our certain design decisions, some of them will be described later.</p><p>Certain sub-parts of views naturally occur more than once in an application. For that reason Angular comes with a notion of directives: a pieces of code (sometimes) with their own templates attached. These may be later reused in views, or other directives. Last, but not least, for implementation of business logic, Angular provides services, which can be used by any controller, or another services.</p><h1 id="UI-Folderstructure">Folder structure</h1><p>The project is structured in the following way:</p><ul><li><strong>font: </strong>external font files used by the application</li><li><strong>graphics:</strong> images used by the application</li><li><strong>less</strong>: stylesheets in the CSS/LESS format</li><li><strong>css: </strong>pre-compiled stylesheets from <strong>less</strong> folder</li><li><strong><span class="inline-comment-marker" data-ref="380f4ff1-0eb6-4926-ac39-9275a65471ca">lib:</span></strong><span class="inline-comment-marker" data-ref="380f4ff1-0eb6-4926-ac39-9275a65471ca"> external libraries</span></li><li><strong>test:</strong> exemplar input files and responses from the server</li><li><strong>src</strong>: application source files <br/><ul><li><strong>common: </strong>directives in the role of subcomponents, such as navigation bar, page footer, etc.</li><li><strong>directives</strong>: generic reusable directives, such as modal window, pagination, tooltips, etc.</li><li><strong>filters: </strong>generic<strong> </strong>custom angular filters</li><li><strong>services:</strong> implementation of business logic, such as REST services, authentication, etc.</li><li><strong>templates:</strong> application screens / views<ul><li>may be structured to subcomponents</li></ul></li><li><strong>util:</strong> generic utilities</li></ul></li></ul><p><strong>index.html</strong>, contained within the root directory, is the application's entry point.</p><h1 id="UI-Externallibraries">External libraries</h1><p>As mentioned, for the overall development, Angular framework was used. Additional used libraries include:</p><ul><li><strong>bootstrap</strong>: a popular, comprehensive CSS framework (<a href="http://getbootstrap.com/" class="external-link" rel="nofollow">http://getbootstrap.com/</a>), speeding up overall development, providing basic styling and allowing for easy implementation of responsive pages</li><li><strong>d3</strong>: a library selected for implementation of graphvis component <em>(see Graphvis below)</em></li><li><strong>date</strong>: provides basic functions for working with dates</li><li><strong>fontawesome</strong>: a popular, icon-based, font for improving overall appearance of the application</li><li><strong>jquery</strong>: better integration with bootstrap as well as speeding up development of directives</li><li><strong>satellizer</strong>: JWT based authentication / authorization library</li><li><strong>uiboostrap</strong>: a collection of several bootstrap modules, packed as directives, for better integration with Angular framework</li><li><strong>less</strong>: interpreter of CSS/LESS stylesheets, used only during development <em>(to optimize the application, the CSS/LESS stylesheets are pre-compiled)</em></li><li><strong>papaparse</strong>: parser of CSV files; for testing purposes only, when running application without the server</li></ul><h1 id="UI-Goals">Goals</h1><p>As mentioned, during development our goal was to keep the application extensible (where possible) while also allowing for easy changes for the common cases. That is why we strived to keep logic and visuals in screens as much as possible separated. Most of the time controllers of screens do actually provide only the functionalities necessary, while leaving visuals solely up to templates of the screens. This may make certain development decisions look illogical to some as demonstrated by the following example, but helping us achieve our goal in the end:</p><p>Template:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: xml; gutter: false; theme: Confluence" data-theme="Confluence">...
&lt;injector for=&quot;msgtxt.configdFailure&quot;&gt;An error occurred while trying to download the task&#39;s configuration.&lt;/injector&gt;
...</pre>
</div></div><p>Corresponding controller:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: js; gutter: false; theme: Confluence" data-theme="Confluence">...
$scope.messages.push(&#39;error&#39;, $scope[&#39;msgtxt.configdFailure&#39;]); 
...</pre>
</div></div><p>The example relates to a situation when there is an uncatched error that needs to be displayed to a user. While it was possible to declare the message in the controller, by injecting it via template we can keep controllers 'clean' and allow for easy changes in the future.</p><h1 id="UI-Applicationloading">Application loading</h1><p><strong>index.html</strong> being the entry point of the application references scripts used via <code>&lt;script src=&quot;...&quot;&gt;</code> HTML element. All external libraries are loaded this way and the main source file, <strong>src/global.js</strong>, defines the way of loading all other resources. It looks up <strong>src/require.json</strong> file for determining what components need to be loaded with an exception of screens, which are then loaded via <strong>src/templates/templates.js</strong>. Usage of JSON files, such as <strong>src/require.json</strong>, allows for easier extensibility of the application, requiring programmer only to write what additional components (s)he would like to be loaded, instead of editing the actual code. This adds to clarity and speeds up development. The components <em>(in this case we mean views, directives, services, ...)</em> then may be separated into several files and may consist of other subcomponents. However, loading of those has to be handled by the corresponding component itself.</p><p>Loading of screens is a little less straightforward. Screens have to be mapped to a certain route. Additionally it may be useful not to have a custom controller specified for certain screens, only a template, where there is no functionality necessary <em>(take for example home screen displaying basic information about the project, while providing no user interaction at all)</em>. For clarity we decided to represent this in <strong>src/templates/mappings.json</strong>. Each screen is represented with an object:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: js; gutter: false; theme: Confluence" data-theme="Confluence">{
    &quot;route&quot;: &quot;/signup/:token&quot;,
    &quot;folder&quot;: &quot;signupcnf&quot;,
    &quot;controller&quot;: &quot;odalic-signupcnf-ctrl&quot;
}</pre>
</div></div><p><span class="inline-comment-marker" data-ref="a89e39cb-5a7c-4efd-91d6-20b61ea4e8ff">while </span><code><span class="inline-comment-marker" data-ref="a89e39cb-5a7c-4efd-91d6-20b61ea4e8ff">&quot;route&quot;</span></code><span class="inline-comment-marker" data-ref="a89e39cb-5a7c-4efd-91d6-20b61ea4e8ff"> being the route the screen is mapped to</span>, <code>&quot;folder&quot;</code> being the name of a folder the screen is located in<em> (omitting <strong>src/templates/</strong>)</em> and<code> &quot;controller&quot;</code> being a name of the corresponding controller. The name has to match the one specified in the actual controller definition. Additionally it may be equal to <code>&quot;generic&quot;</code> in which case it is assumed no custom controller is needed and only the template is loaded for the route. <em>(Note that in this case simply an empty controller is created automatically.)</em></p><p>Please note the AngularJS supports a way to map a screen not only to a specific single route, but also to a <em>pattern</em>. In the case of <code>/signup/:token</code>, upon visiting <code>/signup/anything</code>, the mapping still holds. Not only that, we can also retrieve what <code>:token</code> part of the route is equal to <em>(in this case &quot;<code>anything</code>&quot;) </em>and specify further action based on this information. Such mechanism is used, for instance, by a sign up confirmation screen, which retrieves token directly from the route <em>(route being visited by a user upon receiving an e-mail to 'confirm the sign up by visiting the following link: http://.../signup/GcOiJUz1...')</em>, sends it to server for evaluation and displays information about the state of sign up process to the user.<em><br/></em></p><p>For redirecting purposes there is another type of object that may be specified:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: js; gutter: false; theme: Confluence" data-theme="Confluence">{
    &quot;route&quot;: &quot;/home&quot;,
    &quot;target&quot;: &quot;/&quot;,
    &quot;controller&quot;: &quot;reroute&quot;
}</pre>
</div></div><p>while <code>&quot;route&quot;</code> being the route the &quot;redirect&quot; is mapped to, <code>&quot;target&quot; </code>being the route to redirect to, and <code>&quot;controller&quot;</code> set to <code>&quot;reroute&quot; </code>(for clarity).<code><br/></code></p><p>Name of the template has to always be <strong>template.html</strong> while controller has to be named <strong>controller.js</strong>. Loading of subcomponents / other files is handled individually.</p><h1 id="UI-Screens">Screens</h1><p>The whole application is divided into screens. While some of their elements are the same <em>(e.g. navigation bar, footer, ...)</em>, for the application to be as flexible as possible, none of the elements <em>(except header)</em> are hard-coded in the entry point. This allows for easier implementation of special cases, e.g. when the footer on a certain screen is to be different, or no present at all, etc.</p><p>In order to not repeat large amount of code throughout the screens, we separated common screen elements into 3 subcomponents:</p><ul><li><code>main-cnt</code>: represents a wrapper around 'main content', i.e. the whole screen content needs to be contained within this element.</li><li><code>navbar</code>: a configurable navigation bar, has to be put inside <code>main-cnt</code> element.</li><li><code>footer</code>: a generic footer same for most of the screens.</li></ul><p>That means an ordinary screen template will look like this:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: xml; gutter: false; theme: Confluence" data-theme="Confluence">&lt;!-- Main Content --&gt;
&lt;main-cnt&gt;
    &lt;!-- Navigation Bar --&gt;
    &lt;navbar selected=&quot;home&quot; lmenu=&quot;default-lm.json&quot; rmenu=&quot;default-rm.json&quot;&gt;&lt;/navbar&gt;

    &lt;!-- Content + Sidebar --&gt;
    &lt;div class=&quot;container-fluid&quot;&gt;
        &lt;!-- Sidebar --&gt;
        &lt;div class=&quot;col-sm-3&quot;&gt;
			Sidebar content
        &lt;/div&gt;

        &lt;!-- Content --&gt;
        &lt;div class=&quot;col-sm-9&quot;&gt;
            Main content
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/main-cnt&gt;

&lt;!-- Footer --&gt;
&lt;footer/&gt;</pre>
</div></div><h2 id="UI-Navbar">Navbar</h2><p><code>navbar</code> is a configurable navigation bar, which means on each screen it can be set what items should be available and what item should be highlighted as the selected one. Available items have to be specified as a relative path to a file in JSON format. Specifically, there has to be a file describing menu on the left and a file describing menu on the right on the navigation bar. These two differ in how they work.</p><p>Menu on the left is an array of objects of the following format:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: js; gutter: false; theme: Confluence" data-theme="Confluence">  {
    &quot;id&quot;: &quot;home&quot;,
    &quot;title&quot;: &quot;Home&quot;,
    &quot;link&quot;: &quot;#/&quot;,
    &quot;menu&quot;: []
  }</pre>
</div></div><p>The exemplary object describes a single item on the navigation bar. <code>&quot;id&quot;</code> stands for identifier of the item. This can be referenced when describing what item is selected on a current screen. <code>&quot;title&quot;</code> stands for text displayed, <code>&quot;link&quot;</code> for where to redirect upon click and finally <code>&quot;menu&quot;</code> is an array of subitems. If the <code>&quot;menu&quot;</code> is not an empty array, <code>&quot;link&quot;</code> property should be omitted. The <code>&quot;menu&quot;</code> items look like this:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
    &quot;title&quot;: &quot;File list&quot;,
    &quot;link&quot;: &quot;#/filelist&quot;
}</pre>
</div></div><p>where<code> &quot;title&quot;</code> stands for text displayed, <code>&quot;link&quot;</code> for where to redirect upon click. If no properties are provided, the item is identified as a separator <em>(visual purposes)</em>.</p><p>Menu on the right consists of following type of objects:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">{
    &quot;id&quot;: &quot;signup&quot;,
    &quot;title&quot;: &quot;Sign up&quot;,
    &quot;link&quot;: &quot;#/signup&quot;,
    &quot;icon&quot;: &quot;glyphicon-user&quot;,
    &quot;condition&quot;: &quot;!$auth.isAuthenticated()&quot;
}</pre>
</div></div><p>While being for the most part the same as objects in the left menu, there are some differences:</p><ul><li>Items on the right have an icon attached. See <a href="http://getbootstrap.com/components/" class="external-link" rel="nofollow">http://getbootstrap.com/components/</a> reference for allowed icons.</li><li>Items on the right may not represent a menu of subitems.</li><li>Items on the right may specify a <code>&quot;condition&quot;</code> property, which determines whether should the item be displayed or not. Note that conditions are evaluated during each Angular digest cycle, therefore complicated conditions may cause performance issues.</li></ul><h1 id="UI-Services">Services</h1><p>ODALIC being a single page application, most of the logic is handled on the server. Data exchanged between client and the server is realized via asynchronous requests (AJAX) and are (mostly) in JSON format. For data exchange a &quot;<strong>rest</strong>&quot; service <em>(actual name of the service)</em> is implemented, which transforms data sent/received, automatically injects headers required by the API and generally eases the overall work with the server's interface. The service is divided into parts corresponding to the ones described in <a href="REST-API-specification_76975884.html">REST API specification</a>.</p><p>To handle generic AJAX requests a &quot;<strong>requests</strong>&quot; service is implemented. Most of the responses from the server have a standardized format and therefore can be automatically parsed and transformed. The service handling this is injected via &quot;<code>ioc['requests']</code>&quot;, where &quot;<strong>ioc</strong>&quot; is a service being a very simple implementation of IoC <em>(inversion of control)</em> pattern<em> (<strong>src/services/ioc/modules.json</strong> is the configuration file)</em>. The &quot;<code>ioc['requests']</code>&quot; additionally handles the case of unauthorized access to resources <em>(redirecting to log in screen by default)</em>.</p><h1 id="UI-Authenticationandauthorization">Authentication and authorization</h1><p>As described in <a href="Authentication-and-authorization_76976075.html">Authentication and authorization</a>, to ensure security, JWT <em>(JSON Web Tokens)</em> standard is used. For this we used Satellizer library (<a href="https://github.com/sahat/satellizer" class="external-link" rel="nofollow">https://github.com/sahat/satellizer</a>), which automatically signs each AJAX request with an appropriate authorization header and allows for easy token storage on a user's computer. Additionally, the library conveniently handles requests for logging and signing up.</p><p>Several screens are associated with the authentication / authorization process:</p><ul><li><strong>signup</strong>: allows users to sign up</li><li><strong>signupcnf</strong>: maps to a route received by a user in an e-mail <em>(the e-mail requesting user's confirmation for signing up)</em>; automatically handles additional requests associated with the process and displays notifications about the current state</li><li><strong>login</strong>: allows users to log into or out of the application, re-checks token <em>(to ensure its validity)</em> and displays the current state</li><li><strong>chngpasswd</strong>: allows users to change their password</li><li><strong>chngpasswdcnf</strong>: maps to a route received by a user in an e-mail<em> (the e-mail requesting user's confirmation for changing his/her password)</em>; automatically handles additional requests associated with the process and displays notifications about the current state</li></ul><h1 id="UI-Directives">Directives</h1><p>While directives were designed to solve many different kinds of issues, there are some patterns we followed during development. We will demonstrate our approach, when designing directives, on an example of a confirmation modal window.</p><p>A confirmation modal window is a piece of HTML code consisting of several divisional elements (<code>&lt;div&gt;</code>) with correctly attached pre-defined classes. The classes as well as functionality is provided by the bootstrap framework. Therefore an example of how a modal window may look like, may be found here: <a href="http://www.w3schools.com/bootstrap/bootstrap_modal.asp" class="external-link" rel="nofollow">http://www.w3schools.com/bootstrap/bootstrap_modal.asp</a>. What remains is a way to open the modal window and a way to close it from outside the directive. <em>(Note bootstrap already supports a way to open / close the modal window; however, a concrete element has to be selected first, which is rather impractical to do inside of a screen's controller.)</em> For that purpose we reserved a single attribute, <code>&quot;bind&quot;</code>, acting as a 'gate' to our directive's interface. An example can be seen below:</p><p>Inside of a template we can use the directive the following way:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: xml; gutter: false; theme: Confluence" data-theme="Confluence">&lt;!-- Confirm modal window --&gt;
&lt;confirm bind=&quot;myobj&quot; title=&quot;Title&quot;&gt;
    confirm modal window content, &#39;yes or no&#39; question
&lt;/confirm&gt;

&lt;!-- Button to open the modal window with --&gt;
&lt;button ng-click=&quot;open()&quot;&gt;Open&lt;/button&gt;</pre>
</div></div><p>Inside of a corresponding controller we may specify the following code:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: js; gutter: false; theme: Confluence" data-theme="Confluence">// Initialization; the object will be filled by the corresponding functions automatically
scope.myobj = {};

// On button click
scope.open = function() {
    // Open the modal
    scope.myobj.open(function (response) {
        // Upon closing the modal, this will be automatically called
        if (!response) {
            console.log(&#39;A user answered &quot;no&quot;.&#39;);
        }
    });
};</pre>
</div></div><p>It is worth mentioning that we strived to put visually related interface into separate attributes <em>(e.g. modal headline is determined by the &quot;title&quot; attribute inside of a template)</em>.<code> &quot;bind&quot;</code> attribute serves mostly as a 'gate' to call a directive's functions. For data or functions to be consumed by a directive itself we usually created individual attributes, as demonstrated by the following example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: xml; gutter: false; theme: Confluence" data-theme="Confluence">&lt;button-load button-class=&quot;btn&quot; action=&quot;f&quot; disabled=&quot;option1.chosen&quot;&gt;Execute&lt;/button-load&gt;</pre>
</div></div><p>Where <code>action</code> is a function to be used by the <code>button-load</code> directive and <code>disabled</code> is an expression to be evaluated by the directive <em>(on certain events)</em>. Exceptions from the rule may happen, however.</p><h1 id="UI-Filehandling">File handling</h1><p>File handling is associated with the following screens:</p><ul><li><strong>addfile</strong>: serves for uploading/attaching new files</li><li><strong>filelist</strong>: displays all user's files; allows downloading, configuration and removal of the files</li><li><strong>createnewtask</strong>: during a task creation/configuration, a new file may be uploaded/attached and configured</li></ul><p>To avoid repeating ourselves, we put a portion of a code serving for uploading/attaching files into a separate subcomponent, <strong>common/fileinput</strong>. It has a form of a directive, i.e. it consists both of an HTML template and a controller handling the logic behind.</p><p>File configuration is handled on several places <em>(all of the screens mentioned at this section)</em>. We approached the problem by creating a subcomponent <strong>common/filesettings, </strong>consisting of a modal window with corresponding controls. On opening the modal, data associated with the existing file configuration is loaded from the server and sent upon close.</p><p>Last, but not least, <strong>filelist</strong> screen has a similar implementation to <strong>taskconfigs</strong> screen <em>(described in the following section)</em>, consisting of a simple table, displaying basic information about each file, while providing actions to further manipulate the files <em>(configuring, downloading and removing the files)</em>.</p><h1 id="UI-Taskhandling">Task handling</h1><p>Task handling is associated with the following screens:</p><ul><li><strong>createnewtask</strong>: serves for creating new tasks while also allowing editing existing tasks</li><li><strong>importtask</strong>: allows creating new tasks by configuration import</li><li><strong>taskconfigs</strong>: displays all user's tasks, shows their basic information and allows for their basic manipulation</li><li><strong>taskresult</strong>: a comprehensive display of a task's result, provided by the server; allows sending feedback and reexecuting the task</li></ul><p><strong>createnewtask</strong> consists, among others, of a <strong>common/fileinput</strong> component, to allow for a simple file upload / attach right during a task's creation / editing. Several form controls are available to allow a detailed task configuration.</p><p><strong>importtask</strong> is a relatively simple screen consisting only of a text field and file input field. The selected task configuration file is processed via HTML5 file API and its data sent to the server <em>(upon clicking the corresponding submit buttons)</em>.</p><p><strong>taskconfig</strong>, similarly to <strong>filelist</strong> screen, is basically a table of tasks, displaying basic information, such as identifier, last modification date and description, while also providing several buttons for manipulating the tasks. The list of tasks, when obtained from the server, is handed to <strong>pagination</strong> directive. The directive processes the list, providing only a sublist to surrounding components, based on a currently selected page.</p><p>An important aspect of <strong>taskconfig</strong> is its ability to display each task's current state. Based on the state, different actions may be taken for each task state <em>(e.g. a running task may not be removed, while only a finished task has a 'go to result' button available)</em>. The states are processed in the following manner:</p><ul><li>At the beginning, a server returns a list of all tasks, while also providing information about each task's current state.</li><li>A list of tasks that are running, is created.</li><li>Each of the task's state from the list is requested each 3 seconds via a time-out function. <em>(It is taken into a consideration that the server may take a longer time to respond, in which case the interval may be prolonged.)</em></li><li>A task, which is no longer running, is removed from the list.</li><li>An action, such as re-running a task, may again change a task's state. If a task is this way put into the running state, it is added to the list of running tasks.</li><li>Upon visiting a different screen, the time-out function is cleared.</li></ul><h1 id="UI-Taskresultscreen">Taskresult screen</h1><p>The <strong>taskresult</strong> screen provides a comprehensive display of a task's result, which was previously computed by the server. The screen allows examining the result, provides means to store and send feedback to the server, and allows for downloading of exported result in various formats.</p><p><strong><br/></strong></p><p><strong>JSON data binding</strong></p><p>In order to work properly, the application needs the following JSON objects from the server:</p><ul><li><p><code>$scope.result</code> - represents an actual result of the algorithm. Additionaly, the object is used as a binding variable for user changes.</p></li><li><p><code>$scope.feedback</code> - contains saved user changes from a previous iteration of the algorithm.</p></li><li><p><code>$scope.inputFile</code> - a user input file.</p></li><li><p><code>$scope.configuration</code> - contains information about chosen knowledge bases, primary knowledge base, etc.</p></li></ul><p>Additional important objects include:</p><ul><li><code>$scope.ignoredColumn</code> - represents ignored columns for feedback.</li><li><code>$scope.noDisambiguationColumn</code> - represents ignored cells in all columns.</li><li><code>$scope.noDisambiguationCell</code> - represents ignored cells.</li></ul><p>An important utility object is &quot;<code>$scope.locked</code>&quot; <span>with flags for locked/unlocked state of entit</span><span>ies</span>. <span>Basic</span><span>al</span><span>ly</span>, every <span>data</span> <span>change</span> <span>causes </span><span>setting </span><span>of a corresponding lock </span><span>to</span><span> &quot;<code>true</code>&quot; </span><span><em>(representing locked state)</em>.</span><span> </span><span>It allows for send</span><span>ing</span><span> only the actually modified data to the </span><span>server. </span><span> </span></p><p><span>In the beginning, </span><span>all </span><span>entities </span><span>are </span><span>unlock</span><span>ed</span><span>. After a u</span><span>ser makes </span><span>some data modification and </span><span>rerun</span><span>s</span><span> the algorithm with his/her feedback, the modified entities will be locked. They stay that way until</span><span> a user modifies his/her feedback again.</span></p><p><span>The structure of the object is as follows:<br/></span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: js; gutter: false; theme: Confluence" data-theme="Confluence">$scope.locked = {
    tableCells: ...,
    subjectColumns: ...,
    graphEdges: ...,
    statisticalData: ...
}</pre>
</div></div><ul><li><code><span>tableCells</span></code><span><span> - two-dimensional array, first dimension ranging from -1 to number of rows <em>(-1 representing the header row)</em>, the second dimension from 0 to number of columns.<br/></span></span></li><li><span><span><code>subjectColumns</code> - one for each knowledge base <em>(</em></span><em>at most one column can be chosen/locked).</em></span></li><li><span><span><code>graphEdges</code> - for relation changes between two columns.</span></span></li><li><span><span><code>statisticalData</code> - for changes of data cube</span></span><span><span>.<br/></span></span></li></ul><p>&quot;<code>$scope.selectedPosition</code>&quot; determines selected position in the table of classifications/disambiguations, e.g.:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: js; gutter: false; theme: Confluence" data-theme="Confluence">$scope.selectedPosition = {
    column: 3,
    row: -1
}</pre>
</div></div><p>&quot;<code>$scope.selectedRelation</code>&quot; determines selected relation between two columns in the graphvis component, e.g.:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: js; gutter: false; theme: Confluence" data-theme="Confluence">$scope.selectedRelation = {
    column1: 2,
    column2: 0
}</pre>
</div></div><p>The code of taskresult screen, being relatively complex, is divided <span>in</span>to several section<span>s:</span></p><ul><li><strong>classdisambiguation</strong>: <span>generates a table showing classifications a</span><span>nd</span><span> </span><span>disambiguations suggested</span><span> b</span><span>y the</span><span> algorithm.</span><span> The user can edit this suggested values</span><span>.</span><br/><ul><li><strong>cdlock</strong>: is a directive which shows lock/unlock icons. Also detects user changes.</li><li><span><strong>cdtable</strong>: </span><span>generates table using cdrow directive. T<span>he first row contains headers of </span><span>the </span><span>input file</span>.<br/></span><ul><li><span> </span><span><strong>cdrow</strong>: represents a single row of the table. S</span><span>hows a winner classification </span><span>or</span><span> disambiguation and provides means for editing the feedback</span><span>.<br/></span></li></ul></li><li><strong>cd</strong><span><strong>modalproposal:</strong> a modal window allowing a user </span><span>to </span><span>create and save his/her own classification/disambiguation for each </span><span>cell in the table. A u</span><span>ser can add </span><span>his</span><span> own entities <em>(but only to </em></span><em>the primary knowledge base).</em></li><li><strong>c</strong><span><strong>dmodalselection:</strong> a modal window showing detailed information about a </span><span>picked cell</span><span> from the table.<br/></span><ul><li><strong>c</strong><span><strong>dselecting</strong>: generates <span>cdselectbox and cdsuggestion</span> for all knowledge bases (see below).<br/></span><ul><li><strong>cdselectbox: </strong>represents a select box using a component <span>ui-selectbox, which is a smart version of select box that allows for displaying HTML elements inside its options (more on </span><a href="https://angular-ui.github.io/ui-select/" class="external-link" rel="nofollow">https://angular-ui.github.io/ui-select/</a><span>). </span></li><li><span><strong>cdsugestion:</strong> </span><span>allows to search for an a</span><span>p</span><span>propriate classification or disambiguation </span><span>via a label.</span></li></ul></li><li><span><strong>cdcheckboxes:</strong> provides settings of ignored values</span></li></ul></li></ul></li><li><strong>relations:</strong> <span>shows suggested relations using t</span><span>he</span><span> graphvis </span><span>component.</span><span> </span><ul><li><span><strong>rlock:</strong> </span><span>shows lock/unlock icons and detects user </span><span>changes in the graphvis component. </span></li><li><strong>r</strong><span><strong>modalselection:</strong> is a modal window providing details of a concrete relation.<br/></span><ul><li><span><strong>rmodalproposal:</strong> allows to create and save a custom relation</span><span>.</span></li><li><strong>rselectbox: </strong><span>a select box similar to cdselectbox, but for relations</span><span> </span>.</li></ul></li><li><span><strong>rsugestion:</strong> a</span><span>llows to search for an a</span><span>p</span><span>propriate </span><span>relation</span><span> </span><span>via a label.</span></li><li><strong>g</strong><span><strong>raphvis</strong>: represents the graph of relations (see &quot;Grapvis&quot; below for further details).<br/></span></li></ul></li><li><span><strong>subjectcolumns:</strong> for </span><span>setting a subject column for all knowledge bases.</span></li><li><strong>statisticaldata:</strong><span> </span><span>setting dimensions and measures and its predicates using the table directive (see below) for data cube.<span> </span></span><ul><li><span><strong>table:</strong> generates a table for given dimensions or measures. Allows to cho</span><span>o</span><span>se predicate </span><span>in a similar manner as </span><span>relations.</span></li></ul></li><li><span><strong>controlsbuttons:</strong> contains control buttons, </span><span>which allow</span><span> to browse the result, save feedback and re-run the algorithm</span><span>.</span></li><li><strong>export:</strong> <span>buttons </span><span>for </span><span>exporting the data in a desired format.</span></li></ul><p><span><strong><br/></strong></span></p><p><span><strong>LodLive</strong></span></p><p>Odalic experimentally cooperates with project LodLive (<a href="https://github.com/dvcama/LodLive" class="external-link" rel="nofollow">https://github.com/dvcama/LodLive</a>). The project provides means to browse resources and their related entities.</p><p><span>A copy of the project is lightly adapted to allow for communication with Odalic. An exit button was added as well as a button for returning a selected resource URL.</span></p><p><span>The communication between Odalic and LodLive is solved by HTML5 Message API (<code>Window.postMessage()</code>). <span> For more information, please visit </span><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage" class="external-link" rel="nofollow">https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage</a>. <br/></span></p><p><span><br/></span></p><p><strong><span style="color: rgb(0,0,0);">Graphvis</span></strong></p><p>A graphvis is a component that is a part of a relationship discovery step of the <strong>taskresult</strong> screen. Graphvis is basically just an SVG <em>(HTML5)</em> element with several controlling buttons.</p><p>At the beginning, a graph is created, based on the data in the task result obtained from the server. Graph is created by the principles of OOP, i.e. vertices, edges and labels are all objects that may be further manipulated. Then, since the graphvis is implemented using D3 library (<a href="https://d3js.org/" class="external-link" rel="nofollow">https://d3js.org/</a>), <em>tick</em> function is called continuously by the D3 <em>(which represents a smallest step in the simulation, what graphvis in its principle is - a simulation).</em></p><p>Several actions are mapped to events, such as clicking on an edge label, or dragging a node with a mouse. The main idea behind the graphvis are <em>states</em>: the only moving parts of the graph are nodes. These are moving only if attractive / repulsive forces are active and if the graph is not stabilized. We can turn the forces off, thus putting the graph into a static state. This serves us for allowing a user to create his/her own links between the nodes. <em>(The states are changed by clicking on the corresponding buttons.) </em>Additionally, the states are applied also when a node is fixed due to a user moving it around<em> (which may be further released by double-clicking on it)</em>. This state is preserved even when changin between 'link creation' and 'node dragging' mode.</p><h1 id="UI-Knowledgebaseconfigurationhandling"><span class="inline-comment-marker" data-ref="e2739b5e-770c-4455-9648-4f1dd4afa10b">Knowledge base configuration handling</span></h1><p>Task handling is associated with the following screens:</p><ul><li><strong>kbconfig</strong>: serves either for creating new knowledge base configurations or editing the exsting ones</li><li><strong>kbimport</strong>: allows creating new knowledge base configurations by configuration import</li><li><strong>kblist</strong>: displays all user's knowledge base configurations, shows their basic information and allows for their basic manipulation</li><li><strong>setproperties</strong>: serves for defining new, or editing existing ones, predicates and classes groups</li></ul><p><strong>kblist</strong> is in many ways similar to other 'listing' screens, such as <strong>filelist</strong> or <strong>taskconfig</strong>. It consists of a table, pagination directive<em> (not to overwhelm the user with all of the configurations on 1 page in case of many configurations defined)</em>, and several buttons to allow the manipulation of the configurations.</p><p><strong>kbconfig </strong>is a rather more complicated screen consisting of several controls to allow detailed specification of a knowledge base configuration. <strong>tabset </strong><em>(provided by the library uibootstrap) </em>groups relevant controls under common tabs and allows switching among them. A new directive, for specifying string arrays by a user, has been added, <strong>cilistbox</strong> <em>(e.g. for specifying skipped attributes in the 'search' tab)</em>. To allow defining and editing predicates and classes groups, a new screen had to be added - <strong>setproperties</strong>. This led to a problem with data persistence: normally, when switching between screens, user-entered data is lost. To avoid that, we used <strong>persist</strong> service to keep the user-entered data while browsing <strong>setproperties</strong> screen and reload the data upon entering <strong>kbconfig </strong>again.</p><p><strong>kbimport</strong> shares a very similar implementation with <strong>importtask</strong> screen.</p>
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Jun 01, 2017 13:30</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
